@tailwind base;
@tailwind components;
@tailwind utilities;

/* Design system rule:
   - CSS variables (--color-*) are reserved for semantic colors (brand & states).
   - Neutral UI colors (grays, borders, surfaces) follow Tailwind palette values
     and may appear as raw rgb(...) for clarity.
*/

/* ====================================
   TEST YOUR FRENCH - PRODUCTION CSS
   Build : npx tailwindcss -i input.css -o style.css --minify
   ==================================== */

@layer base {
    :root {
        /* Couleurs RGB pour opacité dynamique */
        --color-primary: 56 189 248;
        --color-success: 34 197 94;
        --color-premium: 168 85 247;
        --color-success-bright: 4 120 87;
        --color-danger: 239 68 68;
        --color-danger-bright: 185 28 28;
        --color-free: 22 163 74;

        /* Composants UI centralisés */
        --badge-height: 22px;
        --badge-height-mobile: 18px;
        --badge-padding: 0.75rem;
        --badge-padding-mobile: 0.5rem;

        /* Système d'espacement unifié */
        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1.25rem;
        --spacing-lg: 1.5rem;
        --spacing-card: 1.25rem;
        --spacing-section: 1.5rem;
        --radius-button: 0.75rem;
        --radius-card: 0.75rem;

        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 200ms cubic-bezier(0.4, 0, 0.2, 1);

        --z-floating: 10;
        --z-modal: 20;
        --z-notification: 30;
        --z-skip: 40;
        --z-overlay: 60;

        --header-height: 40px;
        --header-mobile: 35px;

        /* 2025 shadows: moins “floating cards”, plus propre */
        --shadow-1: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-2: 0 8px 22px rgba(0, 0, 0, 0.07);
        --shadow-3: 0 16px 44px rgba(0, 0, 0, 0.10);

        /* Surfaces */
        --surface: #ffffff;
        --surface-muted: rgb(248 250 252);
        --border: rgb(226 232 240);

        /* Texte */
        --text-strong: rgb(15 23 42);
        --text: rgb(30 41 59);
        --text-muted: rgb(100 116 139);
    }

    * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;

        /* 2025: fond propre, soft, moins “gadget”, plus stable */
        background:
            radial-gradient(1100px 780px at 18% -10%, rgba(56, 189, 248, 0.18) 0%, transparent 58%),
            radial-gradient(900px 640px at 92% 0%, rgba(168, 85, 247, 0.16) 0%, transparent 58%),
            linear-gradient(to bottom, #f8fafc, #ffffff);

        color: var(--text);
        min-height: 100vh;
        margin: 0;
    }
}

/* ====================================
   COMPONENTS
   ==================================== */

@layer components {

    /* =========================
     STATS (Duolingo-like) — 2025 (COMPLET)
    ========================= */

    .tyf-page {
        min-height: 100vh;
    }

    .tyf-stats-wrap {
        max-width: 72rem;
        margin: 0 auto;
        padding: 1.5rem 1rem 2.5rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .tyf-stats-hero {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-card);
        padding: 1rem 1.1rem;

        /* 2025: ombre plus “calme” */
        box-shadow: var(--shadow-1);
    }

    .tyf-stats-hero-inner {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .tyf-hero-level {
        font-weight: 900;
        color: var(--text-strong);
        padding: 0.12rem 0.45rem;
        border-radius: 9999px;

        background: var(--surface-muted);
        border: 1px solid var(--border);

        /* 2025: micro-contraste, sans “pill” trop criard */
        box-shadow: var(--shadow-1);
    }

    @media (min-width: 768px) {
        .tyf-stats-hero-inner {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
    }

    .tyf-hero-text {
        min-width: 0;
    }

    .tyf-hero-title {
        font-size: 1.25rem;
        font-weight: 900;
        color: rgb(15 23 42);
        line-height: 1.2;
    }

    @media (min-width: 768px) {
        .tyf-hero-title {
            font-size: 1.5rem;
        }
    }

    .tyf-hero-sub {
        font-size: 0.92rem;
        color: rgb(51 65 85);
    }

    .tyf-hero-kicker {
        font-size: 0.78rem;
        color: rgb(100 116 139);
        margin-top: 0.25rem;
    }

    .tyf-empty {
        font-size: 0.9rem;
        color: rgb(100 116 139);
        font-weight: 700;
        padding: 0.25rem 0;
    }

    .tyf-stats-grid {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    @media (min-width: 640px) {
        .tyf-stats-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    @media (min-width: 1024px) {
        .tyf-stats-grid {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }
    }

    .tyf-stats-split {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    @media (min-width: 1024px) {
        .tyf-stats-split {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    .tyf-stats-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-card);
        padding: 0.95rem 1rem;

        /* 2025: cartes quasi “flat”, avec séparation nette */
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);
    }

    .tyf-card-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        margin-bottom: 0.35rem;
    }

    .tyf-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.25rem 0.55rem;
        border-radius: 9999px;
        border: 1px solid rgb(226 232 240);
        background: rgb(248 250 252);
        font-size: 0.72rem;
        font-weight: 900;
        color: rgb(15 23 42);
    }

    .tyf-label {
        font-size: 0.75rem;
        color: rgb(71 85 105);
        font-weight: 800;
        letter-spacing: 0.01em;
    }

    .tyf-value {
        font-size: 1.6rem;
        font-weight: 900;
        color: rgb(15 23 42);
        line-height: 1.05;
    }

    .tyf-hint {
        font-size: 0.75rem;
        color: rgb(100 116 139);
        margin-top: 0.25rem;
    }

    .tyf-section-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }

    .tyf-section-title {
        font-size: 0.9rem;
        font-weight: 900;
        color: rgb(15 23 42);
        margin: 0;
    }

    .tyf-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }

    .tyf-row-title {
        font-size: 0.92rem;
        font-weight: 900;
        color: rgb(15 23 42);
    }

    .tyf-row-meta {
        font-size: 0.78rem;
        color: rgb(100 116 139);
        font-weight: 800;
    }

    .tyf-track {
        height: 14px;
        border-radius: 9999px;
        background: rgb(241 245 249);
        border: 1px solid rgb(226 232 240);
        overflow: hidden;
    }

    .tyf-fill {
        height: 100%;
        border-radius: 9999px;
        background: rgb(var(--color-primary));
        box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .10);
        transition: width 180ms ease;
    }

    .tyf-caption {
        font-size: 0.78rem;
        color: rgb(100 116 139);
        margin-top: 0.5rem;
    }

    .tyf-nudge {
        border: 1px solid rgba(168, 85, 247, 0.18);
        background: linear-gradient(180deg, rgba(168, 85, 247, 0.08), rgba(168, 85, 247, 0.05));
        box-shadow: var(--shadow-1);
    }

    .tyf-nudge-inner {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    @media (min-width: 768px) {
        .tyf-nudge-inner {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
    }

    .tyf-nudge-title {
        font-size: 0.9rem;
        font-weight: 900;
        color: rgb(15 23 42);
    }

    .tyf-nudge-sub {
        font-size: 0.78rem;
        color: rgb(51 65 85);
        margin-top: 0.25rem;
    }

    .tyf-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .tyf-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.35rem 0.6rem;
        border-radius: 9999px;
        background: rgb(248 250 252);
        border: 1px solid rgb(226 232 240);
        font-size: 0.78rem;
        font-weight: 800;
        color: rgb(15 23 42);
    }

    .tyf-table-wrap {
        overflow-x: auto;
    }

    .tyf-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 14px;
        min-width: 520px;
    }

    .tyf-table thead th {
        font-size: 12px;
        color: rgb(100 116 139);
        font-weight: 800;
        padding: 0.65rem 0.5rem;
        border-bottom: 1px solid rgb(226 232 240);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        text-align: left;
    }

    .tyf-table tbody td {
        padding: 0.7rem 0.5rem;
        border-bottom: 1px solid rgb(241 245 249);
        color: rgb(30 41 59);
    }

    .tyf-table tbody tr:hover td {
        background: rgb(248 250 252);
    }

    .tyf-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.2rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.72rem;
        font-weight: 900;
        border: 1px solid rgb(226 232 240);
        background: #fff;
        color: rgb(15 23 42);
    }

    .tyf-tag-ok {
        border-color: rgba(22, 163, 74, .35);
        background: rgba(22, 163, 74, .08);
    }

    .tyf-tag-mid {
        border-color: rgba(56, 189, 248, .35);
        background: rgba(56, 189, 248, .08);
    }

    .tyf-tag-bad {
        border-color: rgba(239, 68, 68, .35);
        background: rgba(239, 68, 68, .08);
    }

    .tyf-mr-xs {
        margin-right: 0.4rem;
    }

    .tyf-nowrap {
        white-space: nowrap;
    }

    /* =========================
   2025 COMPACT OVERRIDES
   Objectif: réduire le hero + densité (desktop), sans casser le mobile
   ========================= */

    @media (min-width: 1024px) {
        .tyf-stats-wrap {
            padding: 1.25rem 1rem 2rem 1rem;
            gap: 0.85rem;
        }

        .tyf-stats-hero {
            padding: 0.75rem 0.95rem;
        }

        .tyf-stats-hero-inner {
            gap: 0.6rem;
        }

        .tyf-hero-title {
            font-size: 1.3rem;
            /* au lieu de 1.5rem */
            line-height: 1.15;
        }

        .tyf-hero-sub {
            font-size: 0.82rem;
        }

        .tyf-hero-kicker {
            font-size: 0.74rem;
        }

        .tyf-stats-card {
            padding: 0.85rem 0.9rem;
        }

        .tyf-value {
            font-size: 1.45rem;
        }
    }

    /* =========================
   Quiz cards micro-interactions (desktop hover + mobile tap)
   IMPORTANT: ça agit sur .quiz-item / .assessment-domain, pas sur les stats cards
   ========================= */

    /* Desktop hover only */
    @media (hover: hover) and (pointer: fine) {
        :is(.quiz-item, .assessment-domain):hover {
            transform: translateY(-2px);
            border-color: rgb(203 213 225);
            background: rgb(248 250 252);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
        }

        :is(.quiz-item, .assessment-domain):active {
            transform: translateY(1px);
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
        }
    }

    /* Mobile tap feedback (no hover jitter) */
    @media (hover: none) and (pointer: coarse) {
        :is(.quiz-item, .assessment-domain):active {
            transform: scale(0.99);
            background: rgb(248 250 252);
            border-color: rgb(203 213 225);
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.07);
        }
    }

    /* Header XP: laisser Tailwind piloter le layout (KISS).
   On ne garde que des "améliorations" non bloquantes. */

    /* XP progress: safe overrides only (single source of truth) */
    :where(#xp-progress-track) {
        border-radius: 9999px;
        overflow: hidden;
    }

    :where(#xp-progress-bar) {
        transition: width 200ms ease;
        will-change: width;
        pointer-events: none;
    }

    /* IMPORTANT: pas de taille/marge/typo ici.
               Tailwind garde le contrôle sur le header. */

    /* Chest (KISS): état verrouillé visible + hover perceptible, sans opacity inline */
    #daily-chest-wrapper {
        position: relative;
        display: inline-flex;
        align-items: center;
        overflow: visible;
    }

    /* Locked state: utiliser un style, pas une opacité inline */
    #daily-chest-wrapper[data-state="locked"] {
        filter: grayscale(1) brightness(0.92);
    }

    /* Hover/Active uniquement sur desktop (comme le reste de ton design) */
    @media (hover: hover) and (pointer: fine) {
        #daily-chest-wrapper:hover {
            filter: brightness(1.06);
        }

        #daily-chest-wrapper:active {
            filter: brightness(1.02);
        }

        #daily-chest-wrapper:hover .chest-icon {
            transform: translateY(-1px) scale(1.03);
        }

        #daily-chest-wrapper:active .chest-icon {
            transform: translateY(1px) scale(0.98);
        }

        /* Locked: hover léger mais pas “premium” */
        #daily-chest-wrapper[data-state="locked"]:hover {
            filter: grayscale(0.85) brightness(0.98);
        }
    }

    .chest-icon {
        position: relative;
        display: inline-flex;
        align-items: center;
        margin-left: 8px;
        font-size: 18px;
        transition: transform 160ms ease, filter 160ms ease;
    }

    /* Available: reste distinct */
    .chest-icon--available {
        cursor: pointer;
        filter: drop-shadow(0 2px 6px rgba(245, 158, 11, 0.45));
    }

    .chest-badge {
        position: absolute;
        top: -6px;
        right: -10px;
        min-width: 18px;
        height: 18px;
        padding: 0 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        line-height: 1;
        font-weight: 700;
        background: #10b981;
        color: #fff;
        border-radius: 9999px;
        box-shadow: var(--shadow-1);
    }


    .tyf-tooltip-panel {
        position: fixed;
        width: max-content;
        max-width: min(320px, 85vw);
        padding: 10px 12px;
        border-radius: 12px;
        background: #111827;
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        font-size: 12px;
        line-height: 1.3;
        z-index: var(--z-overlay);

        opacity: 0;
        pointer-events: none;
        transition: opacity 160ms ease;

        white-space: normal;
        overflow-wrap: anywhere;
        text-align: center;
    }

    .tyf-tooltip-panel:not(.hidden) {
        opacity: 1;
        pointer-events: auto;
    }

    @media (prefers-reduced-motion: reduce) {
        .tyf-tooltip-panel {
            transition: none;
        }
    }

    .tyf-tooltip-panel,
    .tyf-tooltip-panel * {
        color: #ffffff !important;
    }

    .tyf-tooltip-panel::before {
        content: "";
        position: absolute;
        top: -6px;
        left: 50%;
        width: 10px;
        height: 10px;
        background: #111827;
        border-left: 1px solid rgba(255, 255, 255, 0.12);
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        transform: translateX(-50%) rotate(45deg);
    }


    /* Section thèmes (Duolingo-like) */
    #themes-section {
        background: var(--surface);
        border-radius: 20px;
        border: 1px solid var(--border);
        padding: 0.75rem var(--spacing-section) 1rem;
        margin: 0.5rem auto;

        /* 2025: section lisible, pas “bloc flottant” */
        box-shadow: var(--shadow-1);
        overflow: visible;
    }

    /* Supprimer l’effet glass */
    @supports ((backdrop-filter: blur(8px)) or (-webkit-backdrop-filter: blur(8px))) {
        #themes-section {
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
    }

    /* Titre section : simple, fort, lisible */
    #themes-section h2 {
        font-size: 1.6rem;
        font-weight: 900;
        color: rgb(15 23 42);
        text-align: center;
        margin-bottom: 0.75rem;

        /* pas de gradient */
        background: none;
        -webkit-text-fill-color: initial;
    }

    @media (min-width: 640px) {
        #themes-section h2 {
            font-size: 1.75rem;
            margin-bottom: 0.75rem;
        }
    }

    @media (min-width: 1024px) {
        #themes-section h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
    }

    #themes-section::-webkit-scrollbar {
        width: 6px;
    }

    #themes-section::-webkit-scrollbar-track {
        background: transparent;
    }

    #themes-section::-webkit-scrollbar-thumb {
        background: rgba(156, 163, 175, 0.5);
        border-radius: 3px;
    }

    #themes-section::-webkit-scrollbar-thumb:hover {
        background: rgba(156, 163, 175, 0.7);
    }

    #themes-grid {
        display: grid;
        gap: var(--spacing-sm);
        grid-template-columns: repeat(2, 1fr);
        contain: layout;
        overflow: visible;
    }

    @media (min-width: 768px) and (max-width: 1023px) {
        #themes-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }
    }

    @media (min-width: 1024px) {
        #themes-grid {
            grid-template-columns: repeat(5, minmax(160px, 1fr));
            gap: 0.5rem;
            overflow: visible;
            max-height: none;
            scrollbar-gutter: stable both-edges;
        }

        #themes-grid>*:nth-child(n+11) {
            display: none;
        }
    }

    /* Cartes de base réutilisables */
    .tyf-card {
        background: var(--surface);
        border-radius: var(--radius-card);
        border: 1px solid var(--border);
        box-shadow: var(--shadow-1);
    }

    .tyf-card-soft {
        background: var(--surface);
        border-radius: var(--radius-card);
        border: 1px solid var(--border);
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);
    }

    /* Cartes thèmes (Duolingo-like) */
    .theme-item {
        position: relative;
        background: #ffffff;
        border: 2px solid rgb(226 232 240);
        border-radius: 18px;

        padding: calc(var(--badge-height) / 2 + 10px) 1rem 1rem;
        min-height: 96px;

        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;

        cursor: pointer;

        /* DUOLINGO PRESS DEPTH */
        box-shadow: 0 2px 0 rgba(15, 23, 42, 0.10);

        transition:
            transform 140ms ease,
            border-color 140ms ease,
            background-color 140ms ease,
            box-shadow 140ms ease;
    }

    /* Hover unique (ne pas dupliquer) */
    .theme-item:hover {
        transform: translateY(-1px);
        border-color: rgb(203 213 225);
        background: rgb(248 250 252);
        box-shadow: 0 3px 0 rgba(15, 23, 42, 0.12);
    }

    .theme-item:active {
        transform: translateY(2px);
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.10);
    }

    /* Focus propre (pas de gros jump -6px) */
    .theme-item:focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
        transform: translateY(-1px);
    }

    /* Locked (UNE SEULE version cohérente, Duolingo-like) */
    .section-theme-locked {
        opacity: 0.85;
        background: rgb(248 250 252);
        border-color: rgb(226 232 240);
        filter: none;
        cursor: not-allowed;
    }

    .section-theme-locked:hover {
        transform: none;
        box-shadow: none;
    }


    /* Daily reward toast (robuste, sans dépendre de purge Tailwind) */
    .tyf-toast {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        padding: 0.6rem 1rem;
        border-radius: 14px;
        box-shadow: var(--shadow-2);
        border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .tyf-toast--success {
        background: rgb(var(--color-success));
        color: #fff;
    }

    /* Position floating (fallback quand pas de container) */
    .tyf-toast--floating {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: var(--z-notification);
    }

    .tyf-toast--floating {
        pointer-events: none;
    }

    .tyf-toast--floating * {
        pointer-events: auto;
    }

    /* Cartes quiz / domaines */
    :is(.quiz-item, .assessment-domain) {
        background: white;
        border-radius: var(--radius-card);
        border: 1px solid rgb(229 231 235);
        padding: 0.85rem 1rem;
        cursor: pointer;

        /* modern hover feel */
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);
        transform: translateY(0);

        transition:
            transform 160ms ease,
            box-shadow 160ms ease,
            border-color 160ms ease,
            background-color 160ms ease;
    }

    /* Desktop only (pas sur mobile) */
    @media (hover: hover) and (pointer: fine) {
        :is(.quiz-item, .assessment-domain):hover {
            transform: translateY(-2px);
            border-color: rgb(203 213 225);
            background: rgb(248 250 252);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
        }

        :is(.quiz-item, .assessment-domain):active {
            transform: translateY(1px);
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
        }
    }

    /* Focus clavier (accessible) */
    :is(.quiz-item, .assessment-domain):focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16), 0 10px 24px rgba(15, 23, 42, 0.08);
    }

    .theme-card {
        min-height: 120px;
        padding: var(--spacing-lg);
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .fp-display {
        /* 2025: “solid + subtle tint”, pas arc-en-ciel */
        background: rgba(56, 189, 248, 0.10);
        border: 1px solid rgba(56, 189, 248, 0.25);

        border-radius: var(--radius-card);
        padding: var(--spacing-md) var(--spacing-lg);
        margin: 1rem 0;

        font-size: 1.15rem;
        font-weight: 800;
        color: var(--text-strong);

        box-shadow: var(--shadow-1);
    }

    .fp-hint {
        background: #fef3c7;
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: 0.5rem;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    :is(.section-theme-free, .section-theme-premium, .section-theme-unlocked, .section-theme-locked) {
        position: relative;
    }

    .section-theme-free {
        border-color: rgb(var(--color-success));
        background: rgb(var(--color-success) / 0.05);
    }

    .section-theme-premium {
        border-color: rgb(var(--color-premium));
        background: rgb(var(--color-premium) / 0.05);
    }

    .section-theme-unlocked {
        border-color: rgb(var(--color-primary));
        background: rgb(var(--color-primary) / 0.05);
    }


    /* Badge "sticker" plus doux */
    :is(.section-theme-free, .section-theme-premium, .section-theme-unlocked, .section-theme-locked)::before {
        position: absolute;
        top: 10px;
        left: 10px;
        transform: none;

        display: inline-flex;
        align-items: center;
        justify-content: center;

        height: 22px;
        padding: 0 10px;
        border-radius: 9999px;

        font-weight: 900;
        font-size: 0.72rem;
        letter-spacing: 0.02em;

        /* style Duolingo: badge clair + texte coloré */
        background: rgb(248 250 252);
        border: 1px solid rgb(226 232 240);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);

        pointer-events: none;
        z-index: 10;
    }

    /* FREE */
    .section-theme-free::before {
        content: "FREE";
        color: rgb(22 163 74);
    }

    /* PREMIUM */
    .section-theme-premium::before {
        content: "PREMIUM";
        color: rgb(147 51 234);
    }

    /* UNLOCKED */
    .section-theme-unlocked::before {
        content: "UNLOCKED";
        color: rgb(var(--color-primary));
    }

    /* LOCKED */
    .section-theme-locked::before {
        content: "LOCKED";
        color: rgb(100 116 139);
    }

    .badge-commencer-ici {
        background: rgb(107 114 128);
        color: white;
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    /* Options quiz (Duolingo-like) */
    .option {
        position: relative;
        background: #ffffff;
        border: 2px solid rgb(226 232 240);
        border-radius: var(--radius-button);
        padding: 0.9rem 1rem;
        margin-bottom: 0.6rem;
        cursor: pointer;

        font-weight: 650;

        /* DUOLINGO PRESS DEPTH */
        box-shadow: 0 2px 0 rgba(15, 23, 42, 0.10);

        transition:
            background-color 120ms ease,
            border-color 120ms ease,
            transform 120ms ease,
            box-shadow 120ms ease;
    }

    .option:hover {
        background: rgb(248 250 252);
        border-color: rgb(203 213 225);
        box-shadow: 0 3px 0 rgba(15, 23, 42, 0.12);
    }

    .option:active {
        transform: translateY(2px);
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.10);
    }

    .option:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
        border-color: rgb(var(--color-primary));
    }

    /* APRÈS */
    /* Sélection = état global cohérent (bord + indicator ring) */
    .option.selected {
        background: rgb(var(--color-primary) / 0.12) !important;
        border-color: rgb(var(--color-primary)) !important;
        color: rgb(15 23 42) !important;
        font-weight: 800 !important;

        /* keep physical feel when selected */
        box-shadow: 0 3px 0 rgba(15, 23, 42, 0.10);
    }

    .option.selected .option-indicator {
        border-color: rgb(var(--color-primary));
    }

    /* Correct / incorrect (validé) : moins agressif que 0.30 */
    .option.correct-validated {
        background: rgba(22, 163, 74, 0.14) !important;
        border-color: rgb(22, 163, 74) !important;
        color: rgb(22, 101, 52) !important;
        font-weight: 900 !important;

        box-shadow: 0 3px 0 rgba(15, 23, 42, 0.10);
    }

    .option.incorrect-validated {
        background: rgba(239, 68, 68, 0.14) !important;
        border-color: rgb(239, 68, 68) !important;
        color: rgb(153, 27, 27) !important;
        font-weight: 850 !important;
        box-shadow: 0 3px 0 rgba(15, 23, 42, 0.10);
    }

    /* =========================
       BUTTONS (KISS + no conflict)
       ========================= */

    .tyf-btn-primary,
    :is(#start-first-quiz-btn,
        #retry-quiz-primary-btn,
        #back-to-themes-btn,
        #premium-code-btn,
        #premium-buy-btn,
        #paywall-buy-btn,
        #paywall-code-btn,
        #buy-premium-btn,
        #validate-code-btn,
        #save-profile-btn,
        #quit-quiz-btn,
        #next-question-btn,
        #reload-btn) {
        background: rgb(var(--color-primary));
        color: #ffffff;
        font-weight: 800;
        padding: 0.9rem 1.4rem;
        border-radius: 14px;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.12);
        transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease, filter 120ms ease;
    }

    .tyf-btn-primary:hover:not(:disabled),
    :is(#start-first-quiz-btn,
        #retry-quiz-primary-btn,
        #back-to-themes-btn,
        #premium-code-btn,
        #premium-buy-btn,
        #paywall-buy-btn,
        #paywall-code-btn,
        #buy-premium-btn,
        #validate-code-btn,
        #save-profile-btn,
        #quit-quiz-btn,
        #next-question-btn,
        #reload-btn):hover:not(:disabled) {
        filter: brightness(0.98);
    }

    .tyf-btn-primary:active:not(:disabled),
    :is(#start-first-quiz-btn,
        #retry-quiz-primary-btn,
        #back-to-themes-btn,
        #premium-code-btn,
        #premium-buy-btn,
        #paywall-buy-btn,
        #paywall-code-btn,
        #buy-premium-btn,
        #validate-code-btn,
        #save-profile-btn,
        #quit-quiz-btn,
        #next-question-btn,
        #reload-btn):active:not(:disabled) {
        transform: translateY(2px);
        box-shadow: 0 2px 0 rgba(0, 0, 0, 0.12);
    }

    .tyf-btn-primary:disabled,
    :is(#start-first-quiz-btn,
        #retry-quiz-primary-btn,
        #back-to-themes-btn,
        #premium-code-btn,
        #premium-buy-btn,
        #paywall-buy-btn,
        #paywall-code-btn,
        #buy-premium-btn,
        #validate-code-btn,
        #save-profile-btn,
        #quit-quiz-btn,
        #next-question-btn,
        #reload-btn):disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
    }

    /* Continue with a quick quiz = secondary CTA (smaller) */
    #next-quiz-btn {
        background: rgb(248 250 252);
        color: rgb(15 23 42);
        font-weight: 900;

        padding: 0.55rem 0.9rem;
        font-size: 0.95rem;
        border-radius: 9999px;

        border: 1px solid rgb(226 232 240);
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);

        cursor: pointer;
        transition: background-color 120ms ease, border-color 120ms ease, transform 120ms ease, box-shadow 120ms ease;
    }

    #next-quiz-btn:hover:not(:disabled) {
        background: rgb(241 245 249);
        border-color: rgb(203 213 225);
    }

    #next-quiz-btn:active:not(:disabled) {
        transform: translateY(1px);
    }

    #next-quiz-btn:focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
    }

    #next-quiz-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
    }

    /* Quiz: Back button must be secondary (not CTA) */
    /* Quiz: Back button must be secondary (not CTA) */
    /* IMPORTANT: override aussi les styles "primary" de .quiz-button */
    #prev-question-btn,
    #prev-question-btn.quiz-button {
        background: rgb(243 244 246) !important;
        color: rgb(55 65 81) !important;
        font-weight: 700 !important;

        padding: 0.9rem 1.4rem;
        border-radius: 14px;

        border: 2px solid rgb(229 231 235) !important;
        box-shadow: none !important;
        filter: none !important;

        cursor: pointer;
        transition: background-color 120ms ease, border-color 120ms ease, transform 120ms ease;
    }

    #prev-question-btn:hover:not(:disabled),
    #prev-question-btn.quiz-button:hover:not(:disabled) {
        background: rgb(229 231 235) !important;
        border-color: rgb(209 213 219) !important;
    }

    #prev-question-btn:active:not(:disabled),
    #prev-question-btn.quiz-button:active:not(:disabled) {
        transform: translateY(1px);
    }

    #prev-question-btn:focus-visible,
    #prev-question-btn.quiz-button:focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary)) !important;
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16) !important;
    }

    #prev-question-btn:disabled,
    #prev-question-btn.quiz-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Header quiz navigation pills (always secondary, never CTA) */
    #go-themes-btn,
    #home-quiz-btn {
        background: rgb(248 250 252);
        color: rgb(15 23 42);
        font-weight: 900;
        padding: 0.55rem 0.85rem;
        border-radius: 9999px;
        border: 1px solid rgb(226 232 240);
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);
        transition: background-color 120ms ease, border-color 120ms ease, transform 120ms ease, box-shadow 120ms ease;
    }

    #go-themes-btn:hover:not(:disabled),
    #home-quiz-btn:hover:not(:disabled) {
        background: rgb(241 245 249);
        border-color: rgb(203 213 225);
    }

    #go-themes-btn:active:not(:disabled),
    #home-quiz-btn:active:not(:disabled) {
        transform: translateY(1px);
    }

    #go-themes-btn:focus-visible,
    #home-quiz-btn:focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
    }

    /* Premium unlock (placé APRÈS les états primary, avant secondary) */
    #premium-unlock-btn {
        background: rgb(var(--color-success));
        color: #fff;
        font-weight: 900;
        padding: 0.75rem 1.1rem;
        border-radius: 14px;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.12);
        transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease, opacity 120ms ease;

        align-items: flex-start;
        gap: 0.55rem;
    }

    #premium-unlock-btn:hover:not(:disabled) {
        filter: brightness(0.98);
    }

    #premium-unlock-btn:active:not(:disabled) {
        transform: translateY(2px);
        box-shadow: 0 2px 0 rgba(0, 0, 0, 0.12);
    }

    #premium-unlock-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
    }

    #premium-unlock-btn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgb(var(--color-success) / 0.18), 0 4px 0 rgba(0, 0, 0, 0.12);
    }

    .tyf-btn-secondary,
    :is(#view-stats-btn, #skip-profile-btn, #colors-first-btn, #toggle-details-btn,
        #close-modal-btn, .close-modal-btn,
        #premium-code-modal [data-action="cancel"]) {
        background: rgb(243 244 246);
        color: rgb(55 65 81);
        font-weight: 500;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-button);
        border: 2px solid rgb(229 231 235);
        cursor: pointer;
        transition: background-color var(--transition-fast),
            border-color var(--transition-fast),
            transform var(--transition-fast),
            box-shadow var(--transition-fast);
    }

    .tyf-btn-secondary:focus-visible,
    :is(#view-stats-btn, #skip-profile-btn, #colors-first-btn, #toggle-details-btn,
        #close-modal-btn, .close-modal-btn,
        #premium-code-modal [data-action="cancel"]):focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
    }

    .tyf-btn-secondary:hover:not(:disabled),
    :is(#view-stats-btn, #skip-profile-btn, #colors-first-btn, #toggle-details-btn,
        #close-modal-btn, .close-modal-btn,
        #premium-code-modal [data-action="cancel"]):hover:not(:disabled) {
        background: rgb(229 231 235);
        border-color: rgb(209 213 219);
    }

    .tyf-btn-secondary:active:not(:disabled),
    :is(#view-stats-btn, #skip-profile-btn, #colors-first-btn, #toggle-details-btn,
        #close-modal-btn, .close-modal-btn,
        #premium-code-modal [data-action="cancel"]):active:not(:disabled) {
        transform: translateY(1px);
    }

    /* Ne pas cibler tous les *-btn (trop large) */
    .copy-code-btn {
        background: rgb(var(--color-success));
        color: #fff;
        font-weight: 600;

        padding: 0.5rem 0.9rem;
        font-size: 0.9rem;
        border-radius: 0.6rem;

        border: none;
        cursor: pointer;
        transition: background-color var(--transition-fast),
            border-color var(--transition-fast),
            transform var(--transition-fast),
            opacity var(--transition-fast);
    }

    /* Quiz wrapper (Duolingo-like) */
    /* =========================
   QUIZ SURFACE (KISS)
   ========================= */

    .quiz-wrapper {
        max-width: 42rem;
        margin: 1.25rem auto 1.5rem auto;
        padding: 1.25rem;
        background: var(--surface);
        border-radius: 18px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-1);
        position: relative;
    }

    /* Make the inside feel like one coherent surface (Duolingo-like) */
    #question-container {
        border-radius: 16px;
        border: 1px solid rgb(226 232 240);
        padding: 1.1rem;
        margin-bottom: 0.75rem;
        background: rgb(248 250 252);
    }

    /* Optional: when you want it flatter (less “double card”), keep border but remove tint */
    #question-container.flat {
        background: #ffffff;
    }

    /* Question = élément roi */
    .quiz-question {
        font-size: clamp(1.15rem, 2.6vw, 1.35rem);
        font-weight: 900;
        line-height: 1.35;
        margin-bottom: 1.25rem;
        color: rgb(15 23 42);
    }


    /* Feedback (sorti du bloc cassé) */
    #feedback-container {
        position: relative;
        margin: 1rem auto;
        max-width: 42rem;
        z-index: var(--z-notification);
    }

    #feedback-container.as-toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: min(90%, 500px);
        z-index: var(--z-overlay);
        pointer-events: none;
        margin: 0;
    }

    #feedback-container.as-toast>* {
        pointer-events: auto;
    }

    .options-container.is-validated .option {
        pointer-events: none;
    }

    .options-container.is-validated .option:focus {
        outline: none;
    }

    /* Affiche correctement les retours ligne (\n) dans les messages UI (toasts/feedback) */
    :where(#feedback-container, #daily-reward-toast, #toast-container, .tyf-toast, .tyf-message) {
        white-space: pre-line;
    }

    /* Timer (sorti du bloc cassé) */
    #timer-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.5rem;
        background: rgb(249 250 251);
        border-radius: var(--radius-button);
        border: 1px solid rgb(229 231 235);
    }

    #timer-display {
        font-family: ui-monospace, "SF Mono", Menlo, Consolas, monospace;
        font-size: 1rem;
        font-weight: 700;
        color: rgb(var(--color-primary));
    }

    .feedback-content {
        border-radius: var(--radius-card);
        padding: 1rem 1.25rem;
        margin: 0.5rem 0;
        font-weight: 600;
        text-align: center;
        /* perf: pas de backdrop-filter */
    }

    .feedback-content.correct {
        /* 2025: feedback “clean”, moins flashy, plus premium */
        background: rgba(22, 163, 74, 0.12);
        color: rgb(22, 101, 52);
        border: 1px solid rgba(22, 163, 74, 0.35);

        box-shadow: var(--shadow-1);
        text-shadow: none;
    }

    .feedback-content.incorrect {
        background: rgba(239, 68, 68, 0.10);
        color: rgb(153, 27, 27);
        border: 1px solid rgba(239, 68, 68, 0.35);

        box-shadow: var(--shadow-1);
    }

    .feedback-content.neutral {
        background: rgb(248 250 252);
        color: rgb(15 23 42);
        border: 1px solid rgb(226 232 240);
        box-shadow: var(--shadow-1);
    }

    /* Neutralise TOUT le "text-white" (et variantes) à l'intérieur du feedback */
    #feedback-container .feedback-content,
    #feedback-container .feedback-content * {
        color: inherit;
    }

    /* Si tu veux garder seulement les icônes blanches (optionnel), tu peux ré-autoriser */
    #feedback-container .feedback-content .keep-white {
        color: #fff !important;
    }

    /* Audio player (vrai look player) */
    .tyf-audio-player {
        width: min(420px, 92vw);
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 0.85rem 0.95rem;
        box-shadow: var(--shadow-1);
    }

    .tyf-audio-controls {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        margin-bottom: 0.6rem;
    }

    .tyf-audio-time {
        margin-left: auto;
        font-family: ui-monospace, "SF Mono", Menlo, Consolas, monospace;
        font-size: 0.78rem;
        font-weight: 800;
        color: rgb(100 116 139);
    }

    .tyf-audio-stop {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 32px;
        min-width: 32px;
        padding: 0 0.6rem;

        font-size: 0.78rem;
        font-weight: 800;
        color: rgb(71 85 105);

        background: rgb(241 245 249);
        border: 1px solid rgb(226 232 240);
        border-radius: 8px;

        cursor: pointer;
        transition: background-color 120ms ease, border-color 120ms ease;
        text-decoration: none;
    }

    .tyf-audio-stop:hover {
        background: rgb(226 232 240);
        border-color: rgb(203 213 225);
    }

    .tyf-audio-stop:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    @media (hover: hover) and (pointer: fine) {
        .tyf-audio-stop:hover {
            color: rgb(15 23 42);
        }
    }

    /* Bouton play/pause: on garde ta classe unique + ses états data-state */
    .tyf-audio-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;

        height: 38px;
        min-width: 38px;
        padding: 0 0.85rem;

        border-radius: 9999px;
        border: 1px solid rgb(226 232 240);
        background: #ffffff;

        font-weight: 900;
        font-size: 0.9rem;
        color: rgb(15 23 42);

        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.04);
        cursor: pointer;

        transition: transform 120ms ease, background-color 120ms ease, border-color 120ms ease, box-shadow 120ms ease, filter 120ms ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    @media (hover: hover) and (pointer: fine) {
        .tyf-audio-btn:hover:not(:disabled) {
            background: rgb(241 245 249);
            border-color: rgb(203 213 225);
        }

        .tyf-audio-btn:active:not(:disabled) {
            transform: translateY(1px);
        }
    }

    .tyf-audio-btn:focus-visible {
        outline: none;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
    }

    .tyf-audio-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        box-shadow: none;
    }

    .tyf-audio-btn[data-state="playing"] {
        border-color: rgba(56, 189, 248, 0.45);
        background: rgba(56, 189, 248, 0.10);
    }

    .tyf-audio-btn[data-state="replay"] {
        border-color: rgba(22, 163, 74, 0.40);
        background: rgba(22, 163, 74, 0.10);
    }

    .tyf-question-kicker {
        font-size: 0.8rem;
        font-weight: 800;
        color: rgb(100 116 139);
    }

    .tyf-question-intent {
        font-size: 0.8rem;
        font-weight: 900;
        color: rgb(var(--color-primary));
    }

    /* =========================
       OPTIONS (KISS + JS-aligned)
       JS toggles: .option-indicator div scale-0/scale-100
       ========================= */

    .option-indicator {
        width: 20px;
        height: 20px;
        border: 2px solid rgb(148 163 184);
        border-radius: 9999px;
        margin-right: 16px;
        flex-shrink: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    /* APRÈS */
    /* Dot piloté par CSS (couleur sémantique) + Tailwind garde scale-0/scale-100 si tu veux */
    .option-indicator>.option-indicator-dot {
        width: 100%;
        height: 100%;
        border-radius: 9999px;
        background: rgb(var(--color-primary));
        transition: transform 120ms ease;
        transform-origin: center;
    }

    /* =========================
       DUOLINGO-LIKE QUIZ ACTION BAR (KISS)
       ========================= */

    .tyf-quiz-actions {
        display: flex;
        gap: 0.75rem;
        justify-content: space-between;
        align-items: center;

        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgb(226 232 240);

        /* Aligne la barre d'actions sur la largeur de la card quiz */
        width: 100%;
        max-width: 42rem;
        margin-left: auto;
        margin-right: auto;
    }

    /* Force both buttons to stay on one row (no wrap) */
    @media (max-width: 420px) {

        #prev-question-btn,
        #next-question-btn {
            padding: 0.75rem 1rem !important;
            font-size: 0.95rem !important;
        }
    }

    @media (max-width: 360px) {

        #prev-question-btn,
        #next-question-btn {
            padding: 0.7rem 0.85rem !important;
            font-size: 0.9rem !important;
        }
    }


    /* ====================================
       UIFeatures - Modal compat layer (anti purge Tailwind)
       ==================================== */

    /* Overlay: Sophie paywall / theme preview / premium code / profile / roadmap */
    :where(#sophie-paywall-modal, #theme-preview-modal, #premium-code-modal, #user-profile-modal, #roadmap-modal) {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        padding: 1rem;
        background: rgba(15, 23, 42, 0.55);
        z-index: var(--z-overlay);
    }

    /* Inner card: first direct child is the panel in your templates */
    :where(#sophie-paywall-modal, #theme-preview-modal, #premium-code-modal, #user-profile-modal, #roadmap-modal)>div {
        position: relative;
        width: min(560px, 92vw);
        max-height: min(78vh, 720px);
        overflow: auto;

        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-card);
        box-shadow: var(--shadow-3);

        padding: 1.25rem;
    }

    /* Stats */
    #detailed-stats {
        background: var(--surface-muted);
        border-radius: var(--radius-card);
        border: 1px solid var(--border);
        padding: 1rem;
        margin-top: 1rem;

        box-shadow: var(--shadow-1);

        content-visibility: auto;
        contain-intrinsic-size: 1px 600px;
    }

    #questions-review {
        margin-top: 1rem;
        content-visibility: auto;
        contain-intrinsic-size: 1px 600px;
    }

    .review-question {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: var(--radius-button);
        border: 1px solid rgb(229 231 235);
        background: rgb(249 250 251);
    }

    /* Input Duolingo-like: soft, friendly, readable */
    :is(#premium-code-input, #user-email, #user-firstname) {
        width: 100%;
        padding: 0.9rem 1rem;
        border: 2px solid rgb(226 232 240);
        border-radius: var(--radius-button);
        font-size: 1rem;
        line-height: 1.2;
        background: rgb(248 250 252);
        transition:
            background-color var(--transition-fast),
            border-color var(--transition-fast),
            box-shadow var(--transition-fast),
            transform var(--transition-fast);
    }

    /* PATCH – accessibilité + états (cohérent) */
    :is(#premium-code-input, #user-email, #user-firstname):disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Focus souris/tap: léger (pas de lift) */
    :is(#premium-code-input, #user-email, #user-firstname):focus {
        outline: none;
        background: #ffffff;
        border-color: rgb(203 213 225);
        box-shadow: 0 0 0 2px rgba(203, 213, 225, 0.35);
    }

    /* Focus clavier: net, Duolingo-like */
    :is(#premium-code-input, #user-email, #user-firstname):focus-visible {
        outline: none;
        background: #ffffff;
        border-color: rgb(var(--color-primary));
        box-shadow: 0 0 0 4px rgb(var(--color-primary) / 0.16);
        transform: none;
    }

    /* Autofill: stable + cohérent au focus */
    #premium-code-input:-webkit-autofill,
    #user-email:-webkit-autofill,
    #user-firstname:-webkit-autofill,
    #premium-code-input:-webkit-autofill:focus,
    #user-email:-webkit-autofill:focus,
    #user-firstname:-webkit-autofill:focus,
    #premium-code-input:-webkit-autofill:focus-visible,
    #user-email:-webkit-autofill:focus-visible,
    #user-firstname:-webkit-autofill:focus-visible {
        -webkit-text-fill-color: rgb(15 23 42);
        box-shadow: 0 0 0 1000px rgb(248 250 252) inset;
    }

    /* Placeholder lisible */
    :is(#premium-code-input, #user-email, #user-firstname)::placeholder {
        color: rgb(100 116 139);
        font-weight: 500;
    }

    /* Spécifique code premium (on garde le monospace) */
    #premium-code-input {
        text-align: center;
        font-family: ui-monospace, "SF Mono", Menlo, Consolas, monospace;
        font-weight: 800;
        letter-spacing: 0.12em;
        text-transform: uppercase;
    }

    /* État erreur (optionnel) */
    .tyf-input-error {
        border-color: rgb(var(--color-danger)) !important;
        background: rgb(var(--color-danger) / 0.06) !important;
        box-shadow: 0 0 0 4px rgb(var(--color-danger) / 0.14) !important;
    }

    /* Focus global: visible par défaut */
    :where(a, button, input, textarea, select, [role="button"], [tabindex]):focus-visible {
        outline: 2px solid rgb(var(--color-primary));
        outline-offset: 2px;
    }

    /* IMPORTANT: éviter le double focus (outline + ring) sur tes inputs designés */
    :is(#premium-code-input, #user-email, #user-firstname):focus-visible {
        outline: none;
    }

    /* Bonus UX discret */
    :is(#premium-code-input, #user-email, #user-firstname) {
        caret-color: rgb(var(--color-primary));
    }

    @media (hover: hover) and (pointer: fine) {
        :is(#premium-code-input, #user-email, #user-firstname):hover:not(:disabled) {
            border-color: rgb(203 213 225);
            background: #ffffff;
        }
    }

    /* Accessibilité */
    .skip-link {
        position: absolute;
        left: -999px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
        z-index: var(--z-skip);
    }

    .skip-link:focus {
        left: 0;
        top: 0;
        background: #000;
        color: #fff;
        padding: 0.75rem;
        width: auto;
        height: auto;
        text-decoration: none;
    }

    /* Les composants qui ont déjà un focus “box-shadow” suppriment l’outline */
    .theme-item:focus-visible,
    .option:focus-visible,
    .tyf-btn-secondary:focus-visible,
    :is(#view-stats-btn, #skip-profile-btn, #colors-first-btn, #toggle-details-btn,
        #close-modal-btn, .close-modal-btn):focus-visible {
        outline: none;
    }

    /* JS fallback */
    #js-failed {
        position: fixed;
        inset: 0;
        background: rgb(249 250 251);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: var(--z-overlay);
    }

    #js-failed.show {
        display: flex;
    }

    #js-failed .error-content {
        text-align: center;
        max-width: 28rem;
        padding: var(--spacing-lg);
    }

    #contact-mail {
        color: rgb(var(--color-primary));
        text-decoration: none;
        font-weight: 500;
        transition: color var(--transition-fast);
    }

    /* Responsive desktop compact */
    @media (min-width: 1024px) {
        .theme-item {
            min-height: 70px;
            padding: calc(var(--badge-height) / 2 + 4px) var(--spacing-sm) var(--spacing-sm);
        }

        .theme-item .text-2xl {
            font-size: 1.25rem;
            margin-bottom: 0.125rem;
        }

        .theme-item .text-sm {
            font-size: 0.8rem;
        }

        .theme-item .text-xs {
            font-size: 0.65rem;
            line-height: 1.3;
        }

        #themes-section {
            padding: 0.5rem var(--spacing-section) 0.75rem;
        }
    }

    /* Petit confort bouton retour */
    #back-to-welcome-btn {
        margin-top: 0.5rem;
    }

    @media (min-width: 768px) {
        #back-to-welcome-btn {
            margin-top: 0;
        }
    }


    /* fermeture correcte de @layer components */
}

/* ====================================
   UTILITIES
   ==================================== */

@layer utilities {
    .sr-only {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
    }

    .hidden {
        display: none !important;
    }

    .invisible {
        visibility: hidden;
    }

    .disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Anti-purge: used in ui-charts.js layout */
    .grow {
        flex-grow: 1;
    }

    .shrink-0 {
        flex-shrink: 0;
    }

    .min-w-0 {
        min-width: 0;
    }


    .scrolled {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .timer-hidden {
        transition: opacity var(--transition-fast), transform var(--transition-fast);
    }

    /* QUIZ PROGRESS (KISS) */
    :where(#quiz-progress-bar) {
        background: rgb(var(--color-primary));
        border-radius: 9999px;
        box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.10);
    }

    /* Width utility classes remain the single mechanism */
    .w-pct-0 {
        width: 0%;
    }

    .w-pct-5 {
        width: 5%;
    }

    .w-pct-10 {
        width: 10%;
    }

    .w-pct-15 {
        width: 15%;
    }

    .w-pct-20 {
        width: 20%;
    }

    .w-pct-25 {
        width: 25%;
    }

    .w-pct-30 {
        width: 30%;
    }

    .w-pct-35 {
        width: 35%;
    }

    .w-pct-40 {
        width: 40%;
    }

    .w-pct-45 {
        width: 45%;
    }

    .w-pct-50 {
        width: 50%;
    }

    .w-pct-55 {
        width: 55%;
    }

    .w-pct-60 {
        width: 60%;
    }

    .w-pct-65 {
        width: 65%;
    }

    .w-pct-70 {
        width: 70%;
    }

    .w-pct-75 {
        width: 75%;
    }

    .w-pct-80 {
        width: 80%;
    }

    .w-pct-85 {
        width: 85%;
    }

    .w-pct-90 {
        width: 90%;
    }

    .w-pct-95 {
        width: 95%;
    }

    .w-pct-100 {
        width: 100%;
    }

    /* =========================
    TEXT UTILITIES
    ========================= */

    .tyf-clamp-2 {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }
}

/* ====================================
   PRINT
   ==================================== */

@media print {
    body {
        background: #fff !important;
        color: #000 !important;
    }

    #xp-header,
    .skip-link,
    button,
    #daily-chest-wrapper {
        display: none !important;
    }

    .quiz-wrapper,
    #detailed-stats {
        box-shadow: none !important;
        border: 1px solid #ccc !important;
    }
}

/* ====================================
   MOTION
   ==================================== */

@media (prefers-reduced-motion: reduce) {

    *,
    ::before,
    ::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}